!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MediaTag=e():t.MediaTag=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=62)}([function(t,e,n){"use strict";var r={IMAGE:"image",AUDIO:"audio",VIDEO:"video",PDF:"pdf",DASH:"dash",DOWNLOAD:"download",CRYPTO:"crypto",CLEAR_KEY:"clear-key",MEDIA_OBJECT:"media-object"};t.exports=r},function(t,e,n){"use strict";var r={MATCHER:"matcher",RENDERER:"renderer",FILTER:"filter",SANITIZER:"sanitizer"};t.exports=r},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(1),c=n(5),u=n(3),a=function(t){function e(n,i){r(this,e);var u=o(this,t.call(this,n,s.MATCHER,c.ANY));return u.targetType=i,u}return i(e,t),e.prototype.getTargetType=function(){return this.targetType},e}(u);t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e,n,o){r(this,t),this.identifier=e,this.type=n,this.occurrence=o}return t.prototype.getIdentifier=function(){if(this.identifier)return this.identifier;throw new Error("Plugin has not identifier")},t.prototype.getType=function(){if(this.type)return this.type;throw new Error("Plugin has no type")},t.prototype.getOccurrence=function(){if(this.occurrence)return this.occurrence;throw new Error("Plugin has no occurrence")},t.prototype.start=function(t){return this.process(t)},t}();t.exports=o},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(1),c=n(5),u=n(3),a=function(t){function e(n){return r(this,e),o(this,t.call(this,n,s.RENDERER,c.ONCE))}return i(e,t),e}(u);t.exports=a},function(t,e,n){"use strict";var r={EVERY:"every",ANY:"any",ONCE:"once"};t.exports=r},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(){r(this,t),this.map={}}return t.prototype.isStored=function(t){return!!this.get(t)},t.prototype.store=function(t,e){this.isStored(t)&&console.warn('The key "'+t+'" is already registered, the content will be overwritten.'),this.map[t]=e},t.prototype.unstore=function(t){if(!1!==this.isStored(t)){var e=this.map[t];return delete this.map[t],e}console.warn('The key "'+t+'" not exists in this manager')},t.prototype.get=function(t){return this.map[t]},t.prototype.keys=function(){return Object.keys(this.map)},t.prototype.values=function(){var t=this;return this.keys().map(function(e){return t.get(e)})},t}();t.exports=o},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e){var n=this;r(this,t),Object.keys(e.attributes).forEach(function(t){n[e.attributes[t].name]=e.attributes[t].value})}return t.prototype.getAttribute=function(t){return this[t]},t.prototype.setAttribute=function(t,e){this[t]=e},t.prototype.removeAttribute=function(t){delete this[t]},t.prototype.hasAttributes=function(){return Object.keys(this)>0},t}();t.exports=o},function(t,e,n){"use strict";var r=n(16),o=n(15);t.exports=function(t,e){e.mediaObjects.forEach(function(t){r(t)}),e.activeMediaObject=t,o(t)}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(1),c=n(5),u=n(3),a=function(t){function e(n){return r(this,e),o(this,t.call(this,n,s.FILTER,c.ANY))}return i(e,t),e}(u);t.exports=a},,,function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(9),c=n(0),u=n(6),a=function(t){function e(){return r(this,e),o(this,t.call(this,c.CRYPTO))}return i(e,t),e.prototype.process=function(t){var n=t.getAttribute("data-crypto-key"),r=/\w+:/.exec(n);if(null===r)throw new Error("No algorithm scheme found in data-crypto-key");var o=r[0],i=o.replace(":",""),s=n.replace(o,"");if(t.setAttribute("data-crypto-key",s),!e.functionStore.isStored(i))throw new Error("Algorithm "+i+" is not registered");e.functionStore.get(i)(t)},e}(s);a.functionStore=a.functionStore||new u,a.mediaTypes=[],a.setAllowedMediaTypes=function(t){a.mediaTypes=t},a.getAllowedMediaTypes=function(){return a.mediaTypes},a.addAllowedMediaType=function(t){a.mediaTypes.push(t)},a.addAllAllowedMediaTypes=function(t){t.forEach(function(t){a.addAllowedMediaType(t)})},a.removeAllowedMediaType=function(t){var e=a.mediaTypes.indexOf(t);e>=0&&a.mediaTypes.splice(e,1)},a.removeAllAllowedMediaTypes=function(t){t.forEach(function(t){a.removeAllowedMediaType(t)})},a.isAllowedMediaType=function(t){return a.mediaTypes.some(function(e){return e===t})},t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=n(4),i=n(9),s=n(2),c=n(19),u=n(3),a=n(27),f=n(28),p=n(1),l=function(){function t(e){var n=this;r(this,t),Object.keys(e).forEach(function(t){n[t]=e[t]})}return t.prototype.isAllowed=function(t){return this.permissions&&this.permissions[t]?this.permissions[t]!==f.FORBIDDEN:f.ALLOWED},t.prototype.getPermission=function(t){return this.permissions&&this.permissions[t]?this.permissions[t]:f.ALLOWED},t.prototype.getPermissions=function(){return this.permissions||{}},t.prototype.getPlugins=function(){var t=this;return this.plugins?Object.keys(this.plugins).map(function(e){return Object.keys(t.plugins[e]).map(function(n){var r=void 0;switch(n){case p.RENDERER:r=new o(e);break;case p.FILTER:r=new i(e);break;case p.SANITIZER:r=new c(e);break;case p.MATCHER:r=new s(e);break;case p.GROUP:r=new a(e,n);break;default:r=new u(e,n)}return Object.keys(t.plugins[e][n]).forEach(function(o){var i=t.plugins[e][n][o];r[o]="function"==typeof i&&"process"===o?function(t,e){return function(n){return e(t,n)}}(r,i):i}),r})}).reduce(function(t,e){return t.concat(e)}):[]},t.prototype.getDefaultPlugin=function(){var t=this.processingEngine.defaultPlugin;return this.getPlugins().filter(function(e){return e.identifier===t}).reduce(function(t,e){return t.getType()!==p.MATCHER?t:e})},t}();t.exports=l},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(){r(this,t),this.content=[]}return t.prototype.stack=function(t){this.content.push(t)},t.prototype.unstack=function(){return this.content.pop()},t.prototype.top=function(){return this.content[this.content.length-1]},t.prototype.base=function(){return this.content[0]},t.prototype.isEmpty=function(){return 0===this.content.length},t.prototype.length=function(){return this.content.length},t}();t.exports=o},function(t,e,n){"use strict";t.exports=function(t){t.element.style.display="block";for(var e=t.hookedFns.children(),n=Array.isArray(e),r=0,e=n?e:e[Symbol.iterator]();;){var o;if(n){if(r>=e.length)break;o=e[r++]}else{if(r=e.next(),r.done)break;o=r.value}o.style.display="block"}}},function(t,e,n){"use strict";t.exports=function(t){t.element.style.display="none";for(var e=t.hookedFns.children(),n=Array.isArray(e),r=0,e=n?e:e[Symbol.iterator]();;){var o;if(n){if(r>=e.length)break;o=e[r++]}else{if(r=e.next(),r.done)break;o=r.value}o.style.display="none"}}},,function(t,e,n){"use strict";function r(t){Array.isArray(t)||(t=[t]),t=t.filter(function(t){return t}),r.start(t)}var o=n(25),i=n(32),s=n(33),c=n(40);r.start=function(t){var e=r.loadingEngine||r.processingEngine;t.forEach(function(t){t.hasAttribute("src")||t.hasAttribute("sources")?new s(t,r.processingEngine).mediaObjects.forEach(function(n){t.mediaObject=n,n.loader=r.loader,e.start(n)}):console.warn("Element skipped because has no sources",t)})},r.update=function(t){"store"!==t.origin&&t.getPlugins().forEach(function(t){var e=r.pluginStore.getPlugins(t.getType()).filter(function(e){return e.getIdentifier()===t.getIdentifier()&&e.getType()===t.getType()});if(e.length>1)throw new Error("More than one plugin matched to update for this pass");1===e.length?e.forEach(function(e){Object.keys(t).forEach(function(n){e[n]=t[n]})}):r.pluginStore.store(t)})},r.configure=function(t){(r.loadingEngine||r.processingEngine).configure(t)},r.loadConfigurations=function(t){var e=t.filter(function(t){return t.hasAttribute("configuration")}).map(function(t){return t.getAttribute("configuration")}).reduce(function(t,e){return t.includes(e)||t.push(e),t},[]).map(function(t){return r.loader.configuration(t)});Promise.all(e).then(function(t){var e=[];return t.forEach(function(t){r.update(t),r.configure(t),t.dependencies&&t.dependencies.forEach(function(t){e.includes(t)||e.push(t)})}),Promise.all(e.map(function(t){return r.loader.script(t)}))})},r.pluginStore=r.pluginStore||new i,r.processingEngine=r.processingEngine||new o(r.pluginStore),r.loader=new c,t.exports=r},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(1),c=n(5),u=n(3),a=function(t){function e(n){return r(this,e),o(this,t.call(this,n,s.SANITIZER,c.EVERY))}return i(e,t),e}(u);t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(4),c=n(0),u=function(t){function e(n,i){r(this,e);var s=o(this,t.call(this,c.DOWNLOAD));return s.message=n,s.buttonMessage=i||"Download",s}return i(e,t),e.prototype.process=function(t){var e=document.createElement("button");e.innerHTML=this.buttonMessage,e.onclick=function(){var e=new XMLHttpRequest,n=t.getAttribute("src");e.open("GET",n,!0),e.responseType="blob",e.onload=function(){var n=e.response;if(n)if(t.name)saveAs(n,t.name);else if(t.getAttribute("data-attr-type")){var r=t.getAttribute("data-attr-type"),o=r.split("/"),i=new File([n],"download."+(o[1]||"txt"),{type:r});saveAs(i)}else saveAs(n)},e.send()},t.utilsSetAllDataAttributes(e),t.replaceContents([e]),t.return()},e}(s);t.exports=u},,,,function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s={PluginExists:function(t){function e(n){return r(this,e),o(this,t.call(this,'Plugin with same "'+n.identifier+'" identifier found.'))}return i(e,t),e}(Error),TypeNotFound:function(t){function e(){return r(this,e),o(this,t.call(this,"Media Tag could not find the content type of an instance.}."))}return i(e,t),e}(Error),FilterExists:function(t){function e(n){return r(this,e),o(this,t.call(this,'Filter with same "'+n.identifier+' identifier found."'))}return i(e,t),e}(Error),FetchFail:function(t){function e(n){return r(this,e),o(this,t.call(this,'Could not fetch "'+n.url+'", received "'+n.status+": "+n.statusText+'".'))}return i(e,t),e}(Error),InvalidCryptoKey:function(t){function e(){return r(this,e),o(this,t.call(this,"Invalid cryptographic key."))}return i(e,t),e}(Error),InvalidCryptoLib:function(t){function e(){return r(this,e),o(this,t.call(this,"Invalid cryptographic algorithm name."))}return i(e,t),e}(Error),FailedCrypto:function(t){function e(n){return r(this,e),o(this,t.call(this,"Failed to decrypt file"+(n&&n.message?" "+n.message:"")+"."))}return i(e,t),e}(Error)};t.exports=s},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=n(26),i=n(13),s=n(1),c=n(29),u=n(20),a=n(6),f=n(30),p=n(31),l=n(14),h=function(){function t(e){r(this,t),o.that(e).not(void 0),this.pluginStore=e,this.stacks=new f,this.snapshots=new f,this.stats=new a,this.configuration=new i({}),this.defaultPlugin=new u("<p> MediaTag cannot find a plugin able to render your content </p>"),this.STACK_SIZE=50,this.SNAPSHOTS_LIMIT=50}return t.prototype.key=function(t){return t.getId()},t.prototype.configure=function(t){var e=this;this.configuration=t,t.processingEngine&&Object.keys(t.processingEngine).forEach(function(n){e[n]="defaultPlugin"===n?t.getDefaultPlugin():n})},t.prototype.isConfigured=function(){return Boolean(this.configuration)},t.prototype.prepare=function(t){var e=this;!function(){t.return=function(){return e.return(t)},t.state="processing"}();var n=t.getId();this.stacks.store(n,new p),this.snapshots.store(n,new l),this.stats.store(n,{})},t.prototype.start=function(t){this.prepare(t),this.routine(t),this.run(t)},t.prototype.run=function(t){var e=this.key(t),n=this.stacks.top(e);if(!n)return this.end(t);this.configuration?this.configuration.isAllowed(n.identifier)?(n.process||console.warn("FALSY PLUGIN",n),n.process(t)):(this.skip(t,n),this.return(t)):n.process(t)},t.prototype.routine=function(t){this.fill(t),this.snapshot(t),this.check(t)},t.prototype.snapshot=function(t){var e=this.key(t),n=this.stacks.get(e).clone();this.snapshots.stack(e,n)},t.prototype.fill=function(t){var e=this,n=this.key(t),r=this.pluginStore.values(),o=r.filter(function(t){return t.getType()===s.MATCHER}).filter(function(e){return e.process(t)}).map(function(t){return t.getIdentifier()}),i=r.filter(function(t){return t.getType()!==s.MATCHER}).filter(function(t){return o.includes(t.getIdentifier())}),u=c.filterByOccurrencies(i);Object.keys(u).forEach(function(r){u[r].forEach(function(r){e.configuration.isAllowed(r.getIdentifier())?e.stacks.get(n).isStackable(r)&&e.stacks.stack(n,r):e.skip(t,r)})})},t.prototype.skip=function(t,e){var n=t.getId(),r=this.stats.get(n);r?r.skipped||(r.skipped=[]):r={skipped:[]},r.skipped.push(e.identifier)},t.prototype.unstack=function(t){var e=t.getId();return this.stacks[e]?this.stacks[e].pop():null},t.prototype.check=function(t){var e=t.getId();if(this.stacks.length(e)>=this.STACK_SIZE)throw console.error("SNAPSHOTS",this.snapshots.get(e)),new Error("Plugin stack size exceed");if(this.snapshots.length(e)>=this.SNAPSHOT_LIMIT)throw console.error("SNAPSHOTS",this.snapshots.get(e)),new Error("Plugin snapshots count exceed");var n=0;if(this.stacks.plugins(e).forEach(function(t){t.type===s.RENDERER&&n++}),n>1)throw console.error("SNAPSHOTS",this.snapshots.get(e)),new Error("More of one renderer in the stack");if(0===this.stacks.length(e)&&!this.stats.get(e)[s.RENDERER]){if(!this.defaultPlugin)throw new Error("No default plugin assignated");this.stacks.stack(e,this.defaultPlugin)}},t.prototype.return=function(t){var e=t.getId(),n=this.stacks.unstack(e);if(!n)return this.end(t);try{this.stats.get(e)||this.stats.store(e,{}),this.stats.get(e)[n.type]?this.stats.get(e)[n.type]+=1:this.stats.get(e)[n.type]=1}catch(t){console.error(t,this.snapshots.get(e))}n.type!==s.SANITIZER&&n.type!==s.RENDERER&&this.fill(t),this.snapshot(t),this.check(t),this.run(t)},t.prototype.end=function(t){return t.status="processed",t},t.prototype.setDefaultPlugin=function(t){this.defaultPlugin=t},t}();t.exports=h},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e){r(this,t),this.truth=e}return t.that=function(e){return new t(e)},t.prototype.is=function(t){if(this.truth===t)return this;throw new Error("Assertion fail on : "+this.truth+" is "+t)},t.prototype.not=function(t){if(this.truth!==t)return this;throw new Error("Assertion fail on : "+this.truth+" is not "+t)},t}();t.exports=o},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(3),c=function(t){function e(n,i,s){r(this,e);var c=o(this,t.call(this,n,i,s));return c.plugins=[],c}return i(e,t),e.prototype.addPlugin=function(t){!1===this.plugins.includes(t)&&this.plugins.push(t)},e.prototype.removePlugin=function(t,e,n){if(!t)throw new Error("Identifier is null or undefined");this.plugin.filter(function(r){return e&&n?t===r.identifier&&e===r.type&&n===r.occurrence:e?t===r.identifier&&e===r.type:t===r.identifier})},e.prototype.start=function(t){this.plugins.forEach(function(e){e.start(t)})},e}(s);t.exports=c},function(t,e,n){"use strict";var r={ALLOWED:"allowed",REQUIRED:"required",FORBIDDEN:"forbidden"};t.exports=r},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(){r(this,t)}return t.filterByOccurrence=function(t,e){return t.filter(function(t){return t.occurrence===e})},t.filterByOccurrencies=function(t){for(var e={once:[],any:[],every:[]},n=t,r=Array.isArray(n),o=0,n=r?n:n[Symbol.iterator]();;){var i;if(r){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var s=i;e[s.occurrence]?e[s.occurrence].push(s):e[s.occurrence]=Array.of(s)}return e},t}();t.exports=o},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(6),c=function(t){function e(){return r(this,e),o(this,t.apply(this,arguments))}return i(e,t),e.prototype.stack=function(t,e){this.get(t).stack(e)},e.prototype.unstack=function(t){return this.get(t).unstack()},e.prototype.top=function(t){return this.get(t).top()},e.prototype.base=function(t){return this.get(t).base()},e.prototype.isEmpty=function(t){return this.get(t).isEmpty()},e.prototype.length=function(t){return this.get(t).content.length},e.prototype.plugins=function(t){return this.get(t).content},e}(s);t.exports=c},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(5),c=n(1),u=n(3),a=n(14),f=function(t){function e(){return r(this,e),o(this,t.apply(this,arguments))}return i(e,t),e.prototype.isPlugin=function(t){return t instanceof u},e.prototype.isStackable=function(t){return[this.isPlugin(t),!this.content.some(function(e){return e.getIdentifier()===t.getIdentifier()&&e.getType()===t.getType()&&e.getOccurrence()===t.getOccurrence()&&(t.occurrence===s.ONCE||t.occurrence===s.ANY)})].reduce(function(t,e){return t&&e})},e.prototype.stack=function(e){if(!this.isPlugin(e))throw new Error("It can't stacks a non plugin instance");if(!this.isStackable(e))throw new Error("A unique plugin cannot by stacked multiple times");t.prototype.stack.call(this,e)},e.prototype.hasRenderer=function(){return this.content.some(function(t){return t.type===c.renderer})},e.prototype.isEndingByRenderer=function(){return this.base().type===c.RENDERER},e.prototype.clone=function(){return JSON.parse(JSON.stringify(this))},e.prototype.plugins=function(){return this.content()},e}(a);t.exports=f},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(6),c=function(t){function e(){return r(this,e),o(this,t.apply(this,arguments))}return i(e,t),e.prototype.getPlugins=function(t){return this.values().filter(function(e){return e.type===t})},e.prototype.store=function(e){t.prototype.store.call(this,[e.identifier,e.type],e)},e.prototype.unstore=function(n){if(!1!==e.isStored([n.identifier,n.type]))return t.prototype.unstore.call(this,[n.identifier,n.type]);console.warn('The key "'+[n.identifier,n.type]+'" not exists in this manager')},e}(s);t.exports=c},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=n(34),i=n(7),s=n(38),c=function(){function t(e,n){var c=this;r(this,t),this.mediaTagElement=e,this.processingEngine=n;var u=new i(e),a=u.getAttribute("sources")||u.getAttribute("srcs");if(a){var f=this.extractSourceObjects(a),p=this.extractMediaElements(f);this.mediaElements=p,this.mediaElements.forEach(function(t){c.mediaTagElement.appendChild(t)}),this.mediaObjects=this.createMediaObjects(p),o.activate(this.mediaObjects[0],this)}else{var l=new s(e);this.mediaObjects=[l],this.activeMediaObject=this.mediaObjects[0]}}return t.prototype.extractSourceObjects=function(t){return JSON.parse(t)},t.prototype.extractMediaElements=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.extractMediaElement(t))}),n},t.prototype.extractMediaElement=function(t){var e=document.createElement("media");return Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])}),e},t.prototype.createMediaObjects=function(t){var e=[];return t.forEach(function(t){var n=new s(t);e.push(n)}),e},t}();t.exports=c},function(t,e,n){"use strict";var r={clear:n(35),show:n(15),hide:n(16),upgrade:n(36),downgrade:n(37),activate:n(8)};t.exports=r},function(t,e,n){"use strict";t.exports=function(t){t.clearContents()}},function(t,e,n){"use strict";var r=n(8);t.exports=function(t){var e=t.mediaObjects.indexOf(t.activeMediaObject);e<t.mediaObjects.length&&r(t.mediaObjects[e+1],t)}},function(t,e,n){"use strict";var r=n(8);t.exports=function(t){var e=t.mediaObjects.indexOf(t.activeMediaObject);e>0&&r(t.mediaObjects[e-1],t)}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=n(7),i=n(39),s=function(){function t(e){r(this,t),this.id=t.uid(),this.element=e,this.state="idle",this.attributesObject=new o(e);for(var n=i.parse(this.attributesObject),s=Object.keys(n),c=Array.isArray(s),u=0,s=c?s:s[Symbol.iterator]();;){var a;if(c){if(u>=s.length)break;a=s[u++]}else{if(u=s.next(),u.done)break;a=u.value}var f=a;this[f]=n[f]}this.hookedFns={hasChildNodes:e.hasChildNodes.bind(e),removeChild:e.removeChild.bind(e),getLastChild:function(){return e.lastChild},appendChild:e.appendChild.bind(e),children:function(){return e.children}}}return t.prototype.setProperties=function(t){for(var e in t){if(this[e])throw new Error("The property "+e+" already exists in this MediaObject !");this[e]=t[e]}},t.prototype.getId=function(){return this.id},t.prototype.getAttribute=function(t){return this.attributesObject[t]},t.prototype.setAttribute=function(t,e){this.attributesObject[t]=e},t.prototype.removeAttribute=function(t){delete this.attributesObject[t]},t.prototype.getAllDataAttrKeys=function(){return Object.keys(this.attributesObject).filter(function(t){return t.startsWith("data-attr")})},t.prototype.getExtension=function(){return this.extension},t.prototype.getMimeType=function(){return this.mime},t.prototype.hasAttribute=function(t){return t in this.attributesObject},t.prototype.getType=function(){return this.type},t.prototype.getSource=function(){return this.src},t.prototype.getSources=function(){return this.sources},t.prototype.clearContents=function(){for(;this.hookedFns.hasChildNodes();)this.hookedFns.removeChild(this.hookedFns.getLastChild())},t.prototype.replaceContents=function(t){var e=this;this.clearContents(),t.forEach(function(t){return e.hookedFns.appendChild(t)})},t.prototype.utilsSetAllDataAttributes=function(t){var e=this;this.getAllDataAttrKeys().forEach(function(n){return t.setAttribute(n.substr(10),e.getAttribute(n))})},t.prototype.utilsPassAllDataAttributes=function(t){var e=this;this.getAllDataAttrKeys().forEach(function(n){return t.setAttribute(n,e.getAttribute(n))})},t}();s.uid=function(t){return function(){return t++}}(0),s.attributesObject=function(t){var e={};if(t.hasAttributes()){var n=t.attributes;Object.keys(n).forEach(function(t){var r=n[t];e[r.name]=r.value})}return e.hasAttribute=function(t){return e[t]},e},t.exports=s},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(){r(this,t)}return t.extension=function(t){var e=t.getAttribute("data-type");if(e)return e.split("/")[1]},t.type=function(t){var e=t.getAttribute("data-type");if(e)return e.split("/")[0]},t.mime=function(t){return t.getAttribute("data-type")},t.protocol=function(t){var e=t.getAttribute("src").split("://");return e.length>1?e[0]:window.location.protocol},t.hostname=function(t){var e=t.getAttribute("src").split("://");return e.length>1?e[1].split("/")[0]:window.location.hostname},t.source=function(t){return t.getAttribute("src")},t.schemes=function(t){return/\w+:/.exec(t.getAttribute("src"))},t.sources=function(t){var e=t.getAttribute("sources")||t.getAttribute("srcs");return e?JSON.parse(e):null},t.actions=function(t){var e=t.getAttribute("actions");return e?JSON.parse(e):null},t.parse=function(e){return{protocol:t.protocol(e),hostname:t.hostname(e),src:t.source(e),type:t.type(e),extension:t.extension(e),mime:t.mime(e),sources:t.sources(e),actions:t.actions(e)}},t}();t.exports=o},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=n(6),i=n(13),s=function(){function t(){r(this,t),this.store=new o,this.promiseStore=new o}return t.prototype.isStored=function(t){return this.store.isStore(t)},t.prototype.script=function(t){return this.promiseStore.isStored(t)||this.promiseStore.store(t,new Promise(function(e,n){var r=document.createElement("script");r.type="text/javascript",r.src=t,r.onload=e,r.onerror=n,r.abort=n,document.head.appendChild(r)})),this.promiseStore.get(t)},t.prototype.configuration=function(t){var e=this;return this.store.isStored(t)?new Promise(function(n){n(new i(e.store.get(t)))}):new Promise(function(n,r){var o=document.createElement("script");o.src=t,o.type="text/javascript",document.addEventListener("Configuration",function(r){var o=r.configuration;e.store.isStored(t)?o.origin="store":(e.store.store(t,r.configuration),o.origin=t),n(new i(o))}),o.onerror=function(t){r(t)},document.head.appendChild(o)})},t.prototype.algorithm=function(t){var e=this;return this.promiseStore.isStored(t)||this.promiseStore.store(t,new Promise(function(n,r){var o=document.createElement("script");o.src=t,o.type="text/javascript",document.addEventListener("Algorithm",function(r){e.store.isStored(t)||e.store.store(t,r.algorithm),n(e.store.get(t))}),o.onerror=function(t){r(t)},document.head.appendChild(o)})),this.promiseStore.get(t)},t}();t.exports=s},,function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t){var e=t.getAttribute("src"),n=t.getAttribute("data-crypto-key"),r=s.getKeyFromStr(n),o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){var e=o.response;if(e){var n=new Uint8Array(e),i=s.decrypt(n,r),u=c.getBlobUrl(i,t.getMimeType()),a=new Event("decryption");a.blob=new Blob([i],{type:t.getMimeType()}),window.document.dispatchEvent(a),t.setAttribute("src",u),t.removeAttribute("data-crypto-key"),t.return()}},o.send(null)}var i=n(24),s=(n(12),function(){function t(){r(this,t)}return t.slice=function(t){return Array.prototype.slice.call(t)},t.getRandomKeyStr=function(){var t=window.nacl,e=t.randomBytes(18);return t.util.encodeBase64(e)},t.getKeyFromStr=function(t){var e=window.nacl;return e.hash(e.util.decodeBase64(t)).subarray(32,64)},t.encrypt=function(e,n){var r=e,o=window.nacl.randomBytes(24),i=window.nacl.secretbox(r,o,n);if(i)return new Uint8Array(t.slice(o).concat(t.slice(i)));throw new Error},t.decrypt=function(e,n){if(e.length<24)throw new Error;var r=t.slice,o=window.nacl,i=new Uint8Array(r(e).slice(0,24)),s=new Uint8Array(r(e).slice(24)),c=o.secretbox.open(s,i,n);if(c)return c;throw new Error("Decrypted file in undefined")},t}()),c=function(){function t(){r(this,t)}return t.getArrayBuffer=function(t){return fetch(t).then(function(t){if(t.ok)return t.arrayBuffer();throw new i.FetchFails}).then(function(t){return t})},t.createUrl=function(t){return window.URL.createObjectURL(t)},t.getBlobUrl=function(t,e){return window.URL.createObjectURL(new Blob([t],{type:e}))},t.getDataUrl=function(t,e){return"data:"+e+";base64,"+window.nacl.util.encodeBase64(t)},t}();t.exports=o},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){var n=e.type.split("/"),r=e.type,o=n[0],i=n[1];u.isAllowedMediaType(r)?(t.setAttribute("data-type",e.type),t.type=o,t.extension=i,t.mime=r):console.log("Not allowed metadata, allowed ones are : ",u.getAllowedMediaTypes()),t.name=e.name,t.setAttribute("data-attr-type",e.type)}function i(t){var e=t.getAttribute("src"),n=t.getAttribute("data-crypto-key"),r=a.getKeyFromStr(n),i=new XMLHttpRequest,s=[e,n].join(""),p=function(e){var n=function(e){c.processingEngine.return(t),"function"==typeof e&&e(t)},r={};r.metadata=e.metadata,o(t,e.metadata);var i=e.content,s=f.getBlobUrl(i,t.getMimeType());if(r.blob=new Blob([i],{type:t.getMimeType()}),r.metadata=e.metadata,u.addAllowedMediaType("audio/mpeg"),t.setAttribute("src",s),t.removeAttribute("data-crypto-key"),/audio\/(mp3|ogg|wav|webm|mpeg)/.test(e.metadata.type)||/application\/pdf/.test(e.metadata.type)||/video\//.test(e.metadata.type)||/image\/(png|jpeg|jpg|gif)/.test(e.metadata.type)||(e.metadata.type="download"),o(t,e.metadata),r.callback=n,!window.MediaTag_onDecrypted)return void setTimeout(n);window.MediaTag_onDecrypted(r)},l=c.__Cryptpad_Cache=c.__Cryptpad_Cache||{};if(l[s])return p(l[s]);i.open("GET",e,!0),i.responseType="arraybuffer";var h=function(t){var e=new Event("decryptionError");e.message="string"==typeof t?t:t.message,window.document.dispatchEvent(e)};i.onload=function(){if(/^4/.test(""+this.status))return h("XHR_ERROR",this.status);var t=i.response;if(t){var e=new Uint8Array(t);a.decrypt(e,r,function(t,e){if(t)return h(t);l[s]=e,p(e)})}},i.send(null)}var s=n(24),c=n(18),u=n(12),a=function(){function t(){r(this,t)}return t.createNonce=function(){return new Uint8Array(new Array(24).fill(0))},t.increment=function(t){for(var e=t.length;e-- >1;){if("number"!=typeof t[e])throw new Error("E_UNSAFE_TYPE");if(t[e]>255)throw new Error("E_OUT_OF_BOUNDS");if(255!==t[e])return void t[e]++;if(t[e]=0,0===e)throw new Error("E_NONCE_TOO_LARGE")}},t.encodePrefix=function(t){return[65280,255].map(function(e,n){return(t&e)>>8*(1-n)})},t.decodePrefix=function(t){return t[0]<<8|t[1]},t.joinChunks=function(t){return new Blob(t)},t.slice=function(t){return Array.prototype.slice.call(t)},t.getRandomKeyStr=function(){var t=window.nacl,e=t.randomBytes(18);return t.util.encodeBase64(e)},t.getKeyFromStr=function(t){return window.nacl.util.decodeBase64(t)},t.encrypt=function(e,n){var r=e,o=window.nacl.randomBytes(24),i=window.nacl.secretbox(r,o,n);if(i)return new Uint8Array(t.slice(o).concat(t.slice(i)));throw new Error},t.decrypt=function(e,n,r){var o=window.nacl,i=function(t){var n=new Event("decryptionProgress");n.percent=t/e.length*100,window.document.dispatchEvent(n)},s=t.createNonce(),c=0,u=e.subarray(0,2),a=t.decodePrefix(u),f={metadata:void 0},p=new Uint8Array(e.subarray(2,2+a)),l=o.secretbox.open(p,s,n);t.increment(s);try{f.metadata=JSON.parse(o.util.encodeUTF8(l))}catch(t){return r("E_METADATA_DECRYPTION")}if(!f.metadata)return r("NO_METADATA");var h=function(r){setTimeout(function(){var u=131088*c+2+a,f=u+131088;c++;var p=new Uint8Array(e.subarray(u,f)),l=o.secretbox.open(p,s,n);if(t.increment(s),!l)return void r("DECRYPTION_FAILURE");i(Math.min(f,e.length)),r(void 0,l)})},y=[];!function n(){h(function(o,i){return o?setTimeout(function(){r(o)}):i?131088*c<e.length?(y.push(i),n()):(y.push(i),f.content=t.joinChunks(y),r(void 0,f)):void r("UNEXPECTED_ENDING")})}()},t}(),f=function(){function t(){r(this,t)}return t.getArrayBuffer=function(t){return fetch(t).then(function(t){if(t.ok)return t.arrayBuffer();throw new s.FetchFails}).then(function(t){return t})},t.createUrl=function(t){return window.URL.createObjectURL(t)},t.getBlobUrl=function(t,e){return window.URL.createObjectURL(new Blob([t],{type:e}))},t.getDataUrl=function(t,e){return"data:"+e+";base64,"+window.nacl.util.encodeBase64(t)},t}();t.exports=i},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(9),c=n(0),u=function(t){function e(){return r(this,e),o(this,t.call(this,c.CLEAR_KEY))}return i(e,t),e.prototype.process=function(t){var e=t.getAttribute("data-clear-key"),n=e.substring(0,32),r=e.substring(33,65);t.setAttribute("id",n),t.setAttribute("key",r),t.removeAttribute("data-clear-key"),t.return()},e}(s);t.exports=u},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(19),c=n(0),u=function(t){function e(){return r(this,e),o(this,t.call(this,c.MEDIA_OBJECT))}return i(e,t),e.prototype.process=function(t){t.return()},e}(s);t.exports=u},function(t,e,n){"use strict";var r=n(47),o=n(48),i=n(49),s=n(50),c=n(51),u=n(52),a=n(53),f=n(54),p=n(55),l=n(18);l.pluginStore.store(new r),l.pluginStore.store(new o),l.pluginStore.store(new i),l.pluginStore.store(new s),l.pluginStore.store(new c),l.pluginStore.store(new u),l.pluginStore.store(new a),l.pluginStore.store(new f),l.pluginStore.store(new p),t.exports=l},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(0),c=n(1),u=n(2),a=function(t){function e(){return r(this,e),o(this,t.call(this,s.IMAGE,c.RENDERER))}return i(e,t),e.prototype.process=function(t){var e=/^png|jpg|jpeg|gif|svg[+]xml$/,n=/^image[\/](png|jpg|jpeg|gif|svg[+]xml)$/;return t.hasAttribute("src")&&"image"===t.getType()&&null!==e.exec(t.getExtension())&&null!==n.exec(t.getMimeType())},e}(u);t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(0),c=n(1),u=n(2),a=function(t){function e(){return r(this,e),o(this,t.call(this,s.AUDIO,c.RENDERER))}return i(e,t),e.prototype.process=function(t){var e=/^mp3|ogg|webm|wav|mpeg$/,n=/^audio[\/](mp3|ogg|webm|wav|mpeg)$/;return t.hasAttribute("src")&&"audio"===t.getType()&&null!==e.exec(t.getExtension())&&null!==n.exec(t.getMimeType())},e}(u);t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(0),c=n(1),u=n(2),a=function(t){function e(){return r(this,e),o(this,t.call(this,s.VIDEO,c.RENDERER))}return i(e,t),e.prototype.process=function(t){var e=/^mp4|ogg|webm$/,n=/^video[\/](mp4|ogg|webm)$/;return t.hasAttribute("src")&&"video"===t.getType()&&null!==e.exec(t.getExtension())&&null!==n.exec(t.getMimeType())},e}(u);t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(0),c=n(1),u=n(2),a=function(t){function e(){return r(this,e),o(this,t.call(this,s.PDF,c.RENDERER))}return i(e,t),e.prototype.process=function(t){var e=/^pdf$/,n=/^application[\/]pdf$/;return t.hasAttribute("src")&&"application"===t.getType()&&null!==e.exec(t.getExtension())&&null!==n.exec(t.getMimeType())},e}(u);t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(0),c=n(1),u=n(2),a=function(t){function e(){return r(this,e),o(this,t.call(this,s.DASH,c.RENDERER))}return i(e,t),e.prototype.process=function(t){var e=/^dash[+]xml$/,n=/^application[\/]dash[+]xml$/;return t.hasAttribute("src")&&"application"===t.getType()&&null!==e.exec(t.getExtension())&&null!==n.exec(t.getMimeType())},e}(u);t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(0),c=n(1),u=n(2),a=function(t){function e(){return r(this,e),o(this,t.call(this,s.DOWNLOAD,c.RENDERER))}return i(e,t),e.prototype.process=function(t){return t.hasAttribute("src")&&"download"===t.getType()},e}(u);t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(0),c=n(1),u=n(2),a=function(t){function e(){return r(this,e),o(this,t.call(this,s.CRYPTO,c.FILTER))}return i(e,t),e.prototype.process=function(t){return t.hasAttribute("data-crypto-key")},e}(u);t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(0),c=n(1),u=n(2),a=function(t){function e(){return r(this,e),o(this,t.call(this,s.CLEAR_KEY,c.FILTER))}return i(e,t),e.prototype.process=function(t){return t.hasAttribute("data-clear-key")},e}(u);t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(0),c=n(1),u=n(2),a=function(t){function e(){return r(this,e),o(this,t.call(this,s.MEDIA_OBJECT,c.SANITIZER))}return i(e,t),e.prototype.process=function(t){return t.hasAttribute("src")&&t.hasAttribute("data-type")},e}(u);t.exports=a},,,,,,,function(t,e,n){"use strict";var r=n(63);document.addEventListener("DOMContentLoaded",function(){function t(t){var r=[];return t.forEach(function(t){t.addedNodes&&t.addedNodes.forEach(function(t){var o=n(t,"MEDIA-TAG").filter(e);r.push.apply(r,o),"MEDIA-TAG"===t.nodeName&&r.push(t)}),"MEDIA-TAG"===t.target.nodeName&&"childList"!==t.type&&(r.includes(t.target)||r.push(t.target))}),r}function e(t){return t.mediaObjects?t.mediaObjects.some(function(t){return"idle"===t.state}):!t.mediaObject||"idle"===t.mediaObject.state}function n(t,e){var r=[];if(!t.children)return r;for(var o=t.children,i=Array.isArray(o),s=0,o=i?o:o[Symbol.iterator]();;){var c;if(i){if(s>=o.length)break;c=o[s++]}else{if(s=o.next(),s.done)break;c=s.value}var u=c;u.nodeName===e&&r.push(u),r=r.concat(n(u,e))}return r}function o(t){r(t)}function i(e){o(t(e)).catch(function(t){console.error(t)})}var s=new MutationObserver(i),c=document.body,u={characterData:!0,childList:!0,attributes:!0,subtree:!0};s.observe(c,u),o(Array.from(document.getElementsByTagName("media-tag")))}),t.exports=r},function(t,e,n){"use strict";var r=n(42),o=n(43),i=n(64),s=n(65),c=n(66),u=n(67),a=n(68),f=n(20),p=n(12),l=n(44),h=n(45),y=n(46);y.PdfPlugin=u,y.PdfPlugin.viewer="/pdfjs/web/viewer.html",p.functionStore.store("salsa20poly1305",r),p.functionStore.store("cryptpad",o),y.processingEngine.setDefaultPlugin(new f("<p> Media-Tag can't process your content </p>","Download")),y.CryptoFilter=p,y.CryptoFilter.setAllowedMediaTypes(["image/png","image/jpeg","image/jpg","image/gif","audio/mp3","audio/ogg","audio/wav","audio/webm","video/mp4","video/ogg","video/webm","application/pdf","application/dash+xml","download"]),y.pluginStore.store(new i),y.pluginStore.store(new s),y.pluginStore.store(new c),y.pluginStore.store(new u),y.pluginStore.store(new a),y.pluginStore.store(new f),y.pluginStore.store(new p),y.pluginStore.store(new l),y.pluginStore.store(new h),t.exports=y},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(4),c=n(0),u=function(t){function e(){return r(this,e),o(this,t.call(this,c.IMAGE))}return i(e,t),e.prototype.process=function(t){var e=document.createElement("img");e.setAttribute("src",t.getAttribute("src")),t.utilsSetAllDataAttributes(e),t.replaceContents([e]),t.return()},e}(s);t.exports=u},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(4),c=n(0),u=function(t){function e(){return r(this,e),o(this,t.call(this,c.AUDIO))}return i(e,t),e.prototype.process=function(t){var e=document.createElement("audio");e.setAttribute("src",t.getAttribute("src")),e.setAttribute("controls",!0),t.utilsSetAllDataAttributes(e),t.replaceContents([e]),t.return()},e}(s);t.exports=u},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(4),c=n(0),u=function(t){function e(){return r(this,e),o(this,t.call(this,c.VIDEO))}return i(e,t),e.prototype.process=function(t){var e=document.createElement("video");e.setAttribute("src",t.getAttribute("src")),e.setAttribute("controls",!0),t.utilsSetAllDataAttributes(e),t.replaceContents([e]),t.return()},e}(s);t.exports=u},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(4),c=n(0),u={PDFJS:"pdfjs",DEFAULT:"default"},a=function(t){function e(){r(this,e);var n=o(this,t.call(this,c.PDF));return n.viewer=e.viewer,n.mode=e.mode,n}return i(e,t),e.prototype.process=function(t){var e=t.getAttribute("src"),n=document.createElement("iframe");switch(t.getAttribute("data-attr-width")||n.setAttribute("width","100%"),t.getAttribute("data-attr-height")||n.setAttribute("height",document.body.scrollHeight),this.viewer||(this.mode=u.DEFAULT),this.mode){case u.PDFJS:var r=this.viewer+"?file="+e,o=new XMLHttpRequest;o.onload=function(){o.status<400?n.src=r:(console.warn("The pdfjs viewer has not been found ...\n\t\t\t\t\t\t\tThe browser viewer will be used by default"),n.src=""+e)},o.open("HEAD",r,!0),o.send();break;default:n.src=""+e}t.utilsSetAllDataAttributes(n),t.replaceContents([n]),n.onload=function(){t.return()}},e}(s);a.viewer=null,a.mode=u.PDFJS,t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(4),c=n(0),u=function(t){function e(){return r(this,e),o(this,t.call(this,c.DASH))}return i(e,t),e.prototype.process=function(t){var e=document.createElement("video"),n=new shaka.Player(e),r=t.getAttribute("id"),o=t.getAttribute("key");if(r&&o){var i='{"'+r+'": "'+o+'"}',s=JSON.parse(i);n.configure({drm:{clearKeys:s}})}e.setAttribute("controls",!0),t.utilsSetAllDataAttributes(e),t.replaceContents([e]),n.load(t.getAttribute("src")).then(function(){}),t.return()},e}(s);t.exports=u}])});